# 🎯 AI 銷售賦能平台 - 完整 UAT 測試計劃

> **版本**: 1.0
> **創建日期**: 2025-10-08
> **測試範圍**: MVP Phase 1 + MVP Phase 2 (Sprint 1-7)
> **目標**: 提供完整的用戶驗收測試計劃，包含前端可見功能與後端背景功能

---

## 📋 目錄

1. [測試概述](#測試概述)
2. [測試環境準備](#測試環境準備)
3. [測試角色與權限](#測試角色與權限)
4. [測試範圍](#測試範圍)
5. [前端功能測試](#前端功能測試)
6. [後端背景功能測試](#後端背景功能測試)
7. [整合測試](#整合測試)
8. [測試進度追蹤](#測試進度追蹤)
9. [測試記錄模板](#測試記錄模板)
10. [驗收準則](#驗收準則)

---

## 📊 測試概述

### 測試目標
1. ✅ 驗證所有前端頁面功能符合業務需求
2. ✅ 確認後端服務和背景任務正常運行
3. ✅ 檢查系統安全性、性能和可靠性
4. ✅ 驗證整合服務（Azure OpenAI、Dynamics 365、Microsoft Graph）正常工作
5. ✅ 記錄所有測試結果並對比預期效果

### 測試策略
- **前端測試**: 通過UI操作驗證功能
- **後端測試**: 通過API調用、數據庫檢查、日誌查看驗證
- **背景功能測試**: 通過觸發條件、定時任務、日誌追蹤驗證
- **整合測試**: 驗證端到端業務流程

### 測試覆蓋範圍
- ✅ **30個前端頁面** (儀表板、知識庫、提案、客戶、通知、設置等)
- ✅ **77個API端點** (REST APIs)
- ✅ **後端服務** (審計日誌、提醒調度器、推薦引擎、日曆同步等)
- ✅ **安全系統** (RBAC、細粒度權限、加密、審計)

---

## 🔧 測試環境準備

### 環境要求
```yaml
環境類型: Staging/UAT
資料庫: PostgreSQL 16 + pgvector
Redis: 7.0+ (緩存和會話)
Node.js: 18.0+
瀏覽器: Chrome/Firefox/Safari/Edge (最新版本)
設備: 桌面端 (1920x1080) + 移動端 (375x667)
```

### 前置配置檢查清單
```bash
# 1. 環境變數檢查
✅ DATABASE_URL - PostgreSQL連接
✅ REDIS_URL - Redis連接
✅ NEXTAUTH_SECRET - JWT密鑰
✅ NEXTAUTH_URL - 應用URL
✅ AZURE_OPENAI_API_KEY - Azure OpenAI
✅ AZURE_OPENAI_ENDPOINT - OpenAI端點
✅ DYNAMICS_365_CLIENT_ID - Dynamics 365
✅ MICROSOFT_GRAPH_CLIENT_ID - Graph API

# 2. 服務狀態檢查
npm run dev                    # 啟動開發服務器
curl http://localhost:3000/api/health  # 健康檢查

# 3. 數據庫初始化
npm run db:migrate             # 執行遷移
npm run db:seed                # 填充測試數據 (如需要)
```

### 測試數據準備
```sql
-- 創建測試用戶 (3個角色)
INSERT INTO "User" (id, email, first_name, last_name, role, password_hash)
VALUES
  (1001, 'admin@test.com', 'Admin', 'User', 'ADMIN', '$2a$10$...'),
  (1002, 'manager@test.com', 'Manager', 'User', 'SALES_MANAGER', '$2a$10$...'),
  (1003, 'rep@test.com', 'Sales', 'Rep', 'SALES_REP', '$2a$10$...');

-- 創建測試客戶
INSERT INTO "Customer" (id, name, company, email, created_by)
VALUES (2001, 'Test Customer', 'Test Corp', 'customer@test.com', 1003);

-- 創建測試知識庫文檔
INSERT INTO "Document" (id, title, content, category, created_by)
VALUES (3001, 'Test Document', 'Test content...', 'PRODUCT_INFO', 1003);
```

---

## 👥 測試角色與權限

### 角色定義
| 角色 | 權限範圍 | 測試賬號 | 主要測試功能 |
|------|---------|---------|------------|
| **ADMIN** | 完全權限 | admin@test.com | 系統配置、用戶管理、審計日誌、所有功能 |
| **SALES_MANAGER** | 團隊管理 | manager@test.com | 團隊數據查看、報表、審批、提案模板 |
| **SALES_REP** | 個人操作 | rep@test.com | 知識庫、提案生成、客戶管理、會議準備 |

### 權限矩陣驗證
```markdown
測試重點: 確認每個角色只能訪問允許的功能

ADMIN: ✅ 所有頁面 + 審計日誌 + 系統設置
SALES_MANAGER: ✅ 團隊數據 + 報表 ❌ 系統設置
SALES_REP: ✅ 個人數據 ❌ 團隊數據 ❌ 系統設置
```

---

## 🎨 前端功能測試

### 測試分類
1. **認證系統** (登入/登出/註冊)
2. **儀表板頁面** (30個頁面)
3. **知識庫管理** (創建/編輯/搜索/上傳)
4. **提案系統** (模板/生成/版本控制)
5. **客戶管理** (CRM整合/360視圖)
6. **通知系統** (站內通知/偏好設置)
7. **會議準備** (準備包/智能助手)
8. **系統設置** (用戶設置/審計日誌)

---

### 1. 認證系統測試

#### TC-AUTH-001: 標準登入流程
**優先級**: 🔴 極高
**前置條件**: 測試用戶已創建
**測試步驟**:
1. 訪問 http://localhost:3000/login
2. 輸入郵箱: rep@test.com
3. 輸入密碼: (測試密碼)
4. 點擊"登入"按鈕

**預期結果**:
- ✅ 登入成功，跳轉到 /dashboard
- ✅ 顯示用戶名稱在頂部導航欄
- ✅ JWT token存儲在cookie中
- ✅ 無控制台錯誤

**實際結果**: 成功登入
**截圖**: ______________________
**狀態**: ⬜ Pass ⬜ Fail
**測試人員**: ______________________
**測試日期**: ______________________

---

#### TC-AUTH-002: Azure AD SSO登入
**優先級**: 🟡 高
**前置條件**: Azure AD配置正確
**測試步驟**:
1. 訪問登入頁面
2. 點擊"使用Microsoft賬號登入"
3. 在Azure AD頁面輸入企業賬號
4. 授權應用訪問

**預期結果**:
- ✅ 跳轉到Microsoft登入頁
- ✅ 授權後返回應用
- ✅ 自動創建用戶或同步用戶信息
- ✅ 角色映射正確

**實際結果**: 在login頁看不到 "使用Microsoft賬號登入", 不能執行此測試
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-AUTH-003: 登出功能
**優先級**: 🔴 極高
**前置條件**: 用戶已登入
**測試步驟**:
1. 點擊用戶頭像下拉菜單
2. 點擊"登出"
3. 確認登出

**預期結果**:
- ✅ Session清除
- ✅ 跳轉到登入頁
- ✅ 無法訪問受保護頁面
- ✅ Cookie中的token已清除

**實際結果**: 成功執行登出
**狀態**: ⬜ Pass ⬜ Fail

---

### 2. 儀表板頁面測試

#### TC-DASH-001: 主儀表板加載
**優先級**: 🔴 極高
**前置條件**: 用戶已登入
**測試步驟**:
1. 登入後訪問 /dashboard
2. 觀察頁面加載

**預期結果**:
- ✅ 頁面在2秒內完全加載
- ✅ 顯示用戶統計數據(文檔數、提案數等)
- ✅ 顯示最近活動時間線
- ✅ 快速操作按鈕可見
- ✅ 無加載錯誤

**實際結果**: 1. 2秒內加載完成, 2. 現在的儀表板應該是顯示樣本數據, 而不是真實的數據 3.  最近活動時間線的卡片是存在和可以看到樣本數據  4. 能夠看到有 快速操作 部分  5. 沒有加載錯誤
**加載時間**: ______ 秒
**狀態**: ⬜ Pass ⬜ Fail

---

### 3. 知識庫管理測試

#### TC-KB-001: 創建知識庫文檔
**優先級**: 🔴 極高
**前置條件**: 用戶已登入
**測試步驟**:
1. 訪問 /dashboard/knowledge/create
2. 填寫標題: "測試文檔 - UAT"
3. 選擇分類: "產品信息"
4. 輸入內容 (至少100字)
5. 添加標籤: "測試", "UAT"
6. 點擊"發佈"

**預期結果**:
- ✅ 文檔創建成功
- ✅ 跳轉到文檔詳情頁
- ✅ 標題、內容、標籤顯示正確
- ✅ 顯示創建時間和作者
- ✅ 自動生成向量嵌入 (後端背景任務)

**實際結果**: 測試成功
**文檔ID**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-KB-002: 編輯知識庫文檔
**優先級**: 🔴 極高
**前置條件**: 已有測試文檔
**測試步驟**:
1. 訪問文檔詳情頁
2. 點擊"編輯"按鈕
3. 修改標題為 "測試文檔 - UAT (已編輯)"
4. 修改內容
5. 點擊"保存"

**預期結果**:
- ✅ 編輯頁面正常加載
- ✅ 原內容正確顯示
- ✅ 保存成功
- ✅ 版本號增加
- ✅ 顯示"最後更新時間"

**實際結果**: 1. 成功訪問頁面, 2. 看不到文件的原內容, 只是看到上傳的檔案的名稱 3. 可以編輯和保存成功 4. 版本號正常增加  5. 顯示了"最後更新時間"
**版本號**: v1 → v____
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-KB-003: AI智能搜索
**優先級**: 🔴 極高
**前置條件**: 知識庫中有至少5篇文檔
**測試步驟**:
1. 訪問 /dashboard/knowledge/search
2. 輸入搜索查詢: "產品價格"
3. 點擊"搜索"或按Enter

**預期結果**:
- ✅ 向量搜索執行 (後端調用pgvector)
- ✅ 返回相關文檔 (相似度排序)
- ✅ 顯示相似度分數
- ✅ 搜索時間 < 1秒
- ✅ 顯示搜索建議

**實際結果**: 由於在知識庫中出現了錯誤, 所以不能夠繼續此測試 , 會在按下"搜索" 之後出現 : "Search Failed" : knowledge-search.tsx:271
 POST http://localhost:3000/api/knowledge-base/search 500 (Internal Server Error)
performSearch	@	knowledge-search.tsx:271
handleSearchSubmit	@	knowledge-search.tsx:307

**搜索時間**: ______ ms
**返回結果數**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-KB-004: 高級搜索過濾
**優先級**: 🟡 高
**前置條件**: 知識庫中有多種類型文檔
**測試步驟**:
1. 訪問 /dashboard/knowledge/advanced-search
2. 選擇分類: "產品信息"
3. 選擇日期範圍: 最近30天
4. 選擇標籤: "價格"
5. 點擊"應用篩選"

**預期結果**:
- ✅ 所有篩選條件正確應用
- ✅ 結果符合所有條件
- ✅ 顯示篩選結果數量
- ✅ 可以清除篩選

**實際結果**: 1. 按下 [高級搜索過濾] 之後可以選取 限制類別, 標籤篩選 和 資料夾篩選
**篩選後結果數**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-KB-005: 文檔上傳功能
**優先級**: 🔴 極高
**前置條件**: 用戶已登入
**測試步驟**:
1. 訪問 /dashboard/knowledge/upload
2. 點擊"選擇文件"或拖拽文件
3. 上傳測試文件 (PDF/DOCX/TXT)
4. 填寫文檔元數據
5. 點擊"上傳"

**預期結果**:
- ✅ 支援的文件格式: PDF, DOCX, TXT, XLSX
- ✅ 文件上傳成功
- ✅ 顯示上傳進度條
- ✅ 自動提取文本內容 (後端)
- ✅ 生成向量嵌入 (後端背景任務)

**實際結果**: 1. 可以成功上傳不同類型的文件 , 2. 但是沒有自動提取文本內容  3. 也不知道怎樣去測試已經生成向量嵌入
**上傳文件名**: ______________________
**文件大小**: ______ MB
**處理時間**: ______ 秒
**狀態**: ⬜ Pass ⬜ Fail

---

### 4. 提案系統測試

#### TC-PROP-001: 創建提案模板
**優先級**: 🔴 極高
**前置條件**: SALES_MANAGER或ADMIN角色
**測試步驟**:
1. 訪問 /dashboard/templates/new
2. 填寫模板名稱: "UAT測試模板"
3. 選擇範本類型: "銷售提案"
4. 使用Handlebars語法添加變數: {{customer.name}}
5. 點擊"保存模板"

**預期結果**:
- ✅ 模板創建成功
- ✅ Handlebars語法高亮顯示
- ✅ 變數自動識別
- ✅ 模板預覽正常
- ✅ 模板可見性設置正確 (PRIVATE/TEAM/PUBLIC)

**實際結果**: 1. 在dashboard 可以看到有範本管理的選項 2. 在嘗試保存模版時 , 在F12 console log中出現了以下報錯 : page.tsx:268
 POST http://localhost:3000/api/templates 403 (Forbidden)
handleSave	@	page.tsx:268  3. 在[預覽] 時就會出現以下報錯 : page.tsx:192
 POST http://localhost:3000/api/templates/preview-temp 500 (Internal Server Error)
handlePreview	@	page.tsx:192


**模板ID**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-PROP-002: AI生成提案
**優先級**: 🔴 極高
**前置條件**: 已有客戶數據和模板
**測試步驟**:
1. 訪問 /dashboard/proposals/generate
2. 選擇客戶: "Test Customer"
3. 選擇模板: "UAT測試模板"
4. 點擊"生成提案"
5. 等待AI生成完成

**預期結果**:
- ✅ Azure OpenAI調用成功
- ✅ 生成個性化內容
- ✅ 變數正確替換 (customer.name等)
- ✅ 生成時間 < 10秒
- ✅ 提案保存到數據庫

**實際結果**: 由於TC-PROP-001: 創建提案模板 失敗, 所以進行不了這個測試
**生成時間**: ______ 秒
**AI模型**: gpt-4 / gpt-3.5-turbo
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-PROP-003: 提案版本控制
**優先級**: 🟡 高
**前置條件**: 已有提案
**測試步驟**:
1. 打開提案詳情頁
2. 修改提案內容
3. 點擊"保存新版本"
4. 訪問 /dashboard/proposals/[id]/versions

**預期結果**:
- ✅ 新版本創建成功
- ✅ 版本列表顯示所有版本
- ✅ 可以查看任意歷史版本
- ✅ 可以對比兩個版本的差異
- ✅ 可以恢復到歷史版本

**實際結果**: ______________________
**版本號**: v1 → v____ → v____
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-PROP-004: 導出PDF
**優先級**: 🟡 高
**前置條件**: 已有完整提案
**測試步驟**:
1. 打開提案詳情頁
2. 點擊"導出PDF"按鈕
3. 等待PDF生成
4. 下載並查看PDF

**預期結果**:
- ✅ PDF生成成功 (使用Puppeteer)
- ✅ 專業排版和樣式
- ✅ 包含封面和頁眉頁腳
- ✅ 文件大小合理 (< 5MB)
- ✅ 生成時間 < 5秒

**實際結果**: ______________________
**文件大小**: ______ MB
**生成時間**: ______ 秒
**狀態**: ⬜ Pass ⬜ Fail

---

### 5. 客戶管理測試

#### TC-CRM-001: 客戶列表查看
**優先級**: 🔴 極高
**前置條件**: Dynamics 365整合配置
**測試步驟**:
1. 訪問 /dashboard/customers
2. 查看客戶列表

**預期結果**:
- ✅ 從Dynamics 365同步的客戶數據
- ✅ 分頁功能正常 (10/25/50每頁)
- ✅ 搜索功能正常
- ✅ 排序功能正常 (按名稱/公司/創建時間)
- ✅ 加載時間 < 2秒

**實際結果**: ______________________
**客戶總數**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-CRM-002: 客戶360視圖
**優先級**: 🔴 極高
**前置條件**: 已有客戶數據
**測試步驟**:
1. 點擊任意客戶進入詳情頁
2. 查看客戶360視圖

**預期結果**:
- ✅ 基本信息完整顯示
- ✅ 聯繫歷史時間線
- ✅ 相關提案列表
- ✅ 活動記錄
- ✅ CRM數據實時同步

**實際結果**: ______________________
**數據完整性**: ✅ 完整 / ⬜ 部分缺失
**狀態**: ⬜ Pass ⬜ Fail

---

### 6. 通知系統測試

#### TC-NOTIF-001: 站內通知查看
**優先級**: 🟡 高
**前置條件**: 有未讀通知
**測試步驟**:
1. 點擊頂部導航欄的通知圖標
2. 查看通知列表

**預期結果**:
- ✅ 顯示未讀通知數量徽章
- ✅ 通知按時間倒序排列
- ✅ 顯示通知類型圖標
- ✅ 未讀/已讀狀態區分
- ✅ 點擊通知標記為已讀

**實際結果**: ______________________
**未讀通知數**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-NOTIF-002: 通知偏好設置
**優先級**: 🟢 中
**前置條件**: 用戶已登入
**測試步驟**:
1. 訪問 /dashboard/notifications/preferences
2. 修改通知偏好設置
3. 禁用郵件通知
4. 啟用站內通知
5. 保存設置

**預期結果**:
- ✅ 設置頁面正常顯示
- ✅ 當前偏好正確加載
- ✅ 設置保存成功
- ✅ 設置立即生效

**實際結果**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

### 7. 會議準備測試

#### TC-MEET-001: 創建會議準備包
**優先級**: 🔴 極高
**前置條件**: 用戶已登入
**測試步驟**:
1. 訪問 /dashboard/assistant
2. 點擊"創建會議準備包"
3. 填寫會議信息 (標題、時間、參與者)
4. 選擇準備包類型: "銷售會議"
5. 點擊"智能生成"

**預期結果**:
- ✅ 4步驟向導流程順暢
- ✅ AI自動推薦準備項目
- ✅ 可以手動添加/移除項目
- ✅ 可以拖拽排序項目
- ✅ 預計閱讀時間自動計算

**實際結果**: ______________________
**推薦項目數**: ______
**預計閱讀時間**: ______ 分鐘
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-MEET-002: AI會議智能分析
**優先級**: 🔴 極高
**前置條件**: Azure OpenAI配置正確
**測試步驟**:
1. 輸入會議標題和描述
2. 點擊"智能分析"
3. 查看AI分析結果

**預期結果**:
- ✅ 提取參與者信息
- ✅ 識別會議主題
- ✅ 生成討論重點建議 (3-5個)
- ✅ 提供潛在問題和答案 (5-10組)
- ✅ 分析時間 < 5秒

**實際結果**: ______________________
**討論重點數**: ______
**問答對數**: ______
**分析時間**: ______ 秒
**狀態**: ⬜ Pass ⬜ Fail

---

### 8. 系統設置測試

#### TC-SETTINGS-001: 用戶資料更新
**優先級**: 🟡 高
**前置條件**: 用戶已登入
**測試步驟**:
1. 訪問 /dashboard/settings
2. 修改用戶資料 (姓名、電話、職位)
3. 點擊"保存"

**預期結果**:
- ✅ 設置頁面正常加載
- ✅ 當前資料正確顯示
- ✅ 修改保存成功
- ✅ 頂部導航欄用戶名即時更新

**實際結果**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-SETTINGS-002: 審計日誌查看 (ADMIN)
**優先級**: 🔴 極高
**前置條件**: ADMIN角色登入
**測試步驟**:
1. 訪問 /dashboard/admin/audit-logs
2. 查看審計日誌列表
3. 使用篩選條件 (用戶、操作、日期範圍)
4. 導出CSV

**預期結果**:
- ✅ 只有ADMIN可以訪問
- ✅ 顯示完整審計日誌
- ✅ 篩選功能正常
- ✅ 統計數據正確 (成功/失敗率)
- ✅ CSV導出成功

**實際結果**: ______________________
**日誌總數**: ______
**CSV文件大小**: ______ KB
**狀態**: ⬜ Pass ⬜ Fail

---

## 🔧 後端背景功能測試

> **說明**: 這些功能在後端運行，無法直接從UI測試，需要通過API調用、數據庫檢查、日誌查看等方式驗證。

### 測試方法
1. **API測試**: 使用Postman/cURL直接調用API
2. **數據庫檢查**: 查詢PostgreSQL數據表驗證數據
3. **日誌追蹤**: 查看應用日誌和審計日誌
4. **定時任務**: 等待定時觸發或手動觸發
5. **監控面板**: 查看監控系統數據

---

### 1. API中間件測試

#### TC-API-001: 速率限制
**優先級**: 🔴 極高
**測試工具**: Postman/cURL
**測試步驟**:
```bash
# 連續發送100個請求
for i in {1..100}; do
  curl -X GET http://localhost:3000/api/knowledge-base
done
```

**預期結果**:
- ✅ 前60個請求成功 (200 OK)
- ✅ 第61個請求開始返回 429 Too Many Requests
- ✅ 響應頭包含 X-RateLimit-Limit: 60
- ✅ 響應頭包含 X-RateLimit-Remaining: 0
- ✅ 1分鐘後速率限制重置

**實際結果**: ______________________
**第61個請求狀態碼**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-API-002: CORS防護
**優先級**: 🔴 極高
**測試工具**: 瀏覽器開發者工具
**測試步驟**:
```javascript
// 在外部域名的控制台執行
fetch('http://localhost:3000/api/knowledge-base', {
  method: 'GET',
  headers: { 'Origin': 'https://malicious-site.com' }
})
```

**預期結果**:
- ✅ 請求被CORS策略阻止
- ✅ 控制台顯示CORS錯誤
- ✅ 允許的域名請求成功
- ✅ Preflight OPTIONS請求正確處理

**實際結果**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-API-003: 安全頭部檢查
**優先級**: 🔴 極高
**測試工具**: cURL
**測試步驟**:
```bash
curl -I http://localhost:3000/api/health
```

**預期結果**:
- ✅ X-Content-Type-Options: nosniff
- ✅ X-Frame-Options: DENY
- ✅ X-XSS-Protection: 1; mode=block
- ✅ Strict-Transport-Security: max-age=31536000
- ✅ Content-Security-Policy: 存在

**實際結果**: ______________________
**缺失頭部**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

### 2. 審計日誌系統測試

#### TC-AUDIT-001: 權限檢查自動記錄
**優先級**: 🔴 極高
**測試步驟**:
1. 以SALES_REP登入
2. 嘗試訪問ADMIN專屬頁面
3. 檢查審計日誌

**驗證方法**:
```sql
-- 查詢最新審計日誌
SELECT * FROM "AuditLog"
WHERE action = 'PERMISSION_DENY'
ORDER BY timestamp DESC
LIMIT 10;
```

**預期結果**:
- ✅ 記錄拒絕訪問事件
- ✅ 包含用戶ID、資源、操作
- ✅ severity = 'WARNING'
- ✅ success = false
- ✅ details包含拒絕原因

**實際結果**: ______________________
**審計日誌ID**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

#### TC-AUDIT-002: 敏感操作記錄
**優先級**: 🔴 極高
**測試步驟**:
1. 執行敏感操作 (刪除文檔、修改用戶權限)
2. 檢查審計日誌

**驗證方法**:
```sql
SELECT * FROM "AuditLog"
WHERE resource IN ('USERS', 'DOCUMENTS')
  AND action IN ('DELETE', 'UPDATE_PERMISSIONS')
ORDER BY timestamp DESC;
```

**預期結果**:
- ✅ 所有敏感操作都被記錄
- ✅ 包含完整上下文信息
- ✅ IP地址和User-Agent記錄
- ✅ requestId可追蹤

**實際結果**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

### 3. 提醒調度器測試

#### TC-REMINDER-001: 定時提醒觸發
**優先級**: 🔴 極高
**前置條件**: 創建提醒時間為5分鐘後
**測試步驟**:
1. 創建會議提醒 (提醒時間: 當前時間+5分鐘)
2. 等待5分鐘
3. 檢查提醒狀態

**驗證方法**:
```sql
-- 檢查提醒狀態變化
SELECT id, type, status, due_date, triggered_at
FROM "Reminder"
WHERE id = [reminder_id];
```

**預期結果**:
- ✅ 5分鐘後狀態從PENDING變為TRIGGERED
- ✅ triggered_at時間記錄正確
- ✅ 站內通知已創建
- ✅ 郵件通知已發送 (如啟用)

**實際結果**: ______________________
**實際觸發時間**: ______________________
**時間誤差**: ______ 秒 (< 30秒為正常)
**狀態**: ⬜ Pass ⬜ Fail

---

### 4. 向量嵌入生成測試

#### TC-VECTOR-001: 文檔上傳自動嵌入
**優先級**: 🔴 極高
**前置條件**: Azure OpenAI配置正確
**測試步驟**:
1. 上傳新文檔
2. 等待5秒
3. 檢查向量嵌入

**驗證方法**:
```sql
-- 檢查向量嵌入是否生成
SELECT id, title, embedding IS NOT NULL as has_embedding
FROM "Document"
WHERE id = [document_id];
```

**預期結果**:
- ✅ embedding字段不為NULL
- ✅ 向量維度 = 1536 (OpenAI ada-002)
- ✅ 生成時間 < 3秒
- ✅ 文檔可被向量搜索找到

**實際結果**: ______________________
**向量維度**: ______
**狀態**: ⬜ Pass ⬜ Fail

---

### 5. 數據加密測試

#### TC-ENCRYPT-001: 敏感欄位加密
**優先級**: 🔴 極高
**測試步驟**:
1. 創建包含敏感資料的記錄 (電話、郵箱)
2. 直接查詢數據庫

**驗證方法**:
```sql
-- 查看加密前後對比
SELECT id, email, phone
FROM "Customer"
WHERE id = [customer_id];
```

**預期結果**:
- ✅ 敏感欄位在數據庫中已加密
- ✅ 加密值與明文完全不同
- ✅ API返回時自動解密
- ✅ 加密算法: AES-256-GCM

**實際結果**: ______________________
**數據庫中的值**: ______________________ (應為加密後)
**API返回的值**: ______________________ (應為明文)
**狀態**: ⬜ Pass ⬜ Fail

---

### 6. 推薦引擎測試

#### TC-REC-001: 協同過濾推薦
**優先級**: 🟡 高
**前置條件**: 用戶有瀏覽歷史
**測試步驟**:
1. 模擬用戶瀏覽10篇文檔
2. 調用推薦API

**驗證方法**:
```bash
curl -X GET "http://localhost:3000/api/recommendations/content?strategy=collaborative&limit=5" \
  -H "Authorization: Bearer [token]"
```

**預期結果**:
- ✅ 返回5個推薦項目
- ✅ 相關度分數在0-1之間
- ✅ 推薦理由清晰
- ✅ 不推薦已瀏覽的文檔
- ✅ 響應時間 < 500ms

**實際結果**: ______________________
**推薦項目數**: ______
**平均相關度**: ______
**響應時間**: ______ ms
**狀態**: ⬜ Pass ⬜ Fail

---

### 7. 日曆同步測試

#### TC-CAL-SYNC-001: Delta Query增量同步
**優先級**: 🟡 高
**前置條件**: Microsoft Graph OAuth完成
**測試步驟**:
1. 在Microsoft日曆添加新事件
2. 調用同步API
3. 檢查數據庫

**驗證方法**:
```bash
curl -X POST http://localhost:3000/api/calendar/sync \
  -H "Authorization: Bearer [token]"
```

```sql
-- 檢查同步的事件
SELECT * FROM "CalendarEvent"
WHERE user_id = [user_id]
ORDER BY start_time DESC;
```

**預期結果**:
- ✅ 只同步新增/修改的事件 (Delta Query)
- ✅ 事件數據完整 (標題、時間、參與者)
- ✅ Delta token正確更新
- ✅ 同步時間 < 2秒

**實際結果**: ______________________
**同步事件數**: ______
**同步時間**: ______ 秒
**狀態**: ⬜ Pass ⬜ Fail

---

### 8. 緩存系統測試

#### TC-CACHE-001: Redis緩存命中率
**優先級**: 🟢 中
**測試步驟**:
1. 第一次調用API (緩存未命中)
2. 第二次調用同樣的API (應從緩存返回)
3. 比較響應時間

**驗證方法**:
```bash
# 第一次請求
time curl http://localhost:3000/api/knowledge-base/[id]

# 第二次請求 (應該更快)
time curl http://localhost:3000/api/knowledge-base/[id]
```

**預期結果**:
- ✅ 第一次請求: 100-300ms
- ✅ 第二次請求: 10-50ms (快5-10倍)
- ✅ 響應頭包含 X-Cache-Status: HIT
- ✅ 緩存TTL設置正確

**實際結果**: ______________________
**第一次請求時間**: ______ ms
**第二次請求時間**: ______ ms
**加速比**: ______x
**狀態**: ⬜ Pass ⬜ Fail

---

## 🔗 整合測試

### 測試場景: 完整銷售流程

#### TC-E2E-001: 從客戶查詢到提案生成
**優先級**: 🔴 極高
**角色**: SALES_REP
**測試步驟**:

1. **客戶研究階段**
   - 登入系統
   - 訪問客戶列表
   - 查看客戶360視圖
   - 記錄: 客戶需求、預算、決策人

2. **知識準備階段**
   - 搜索相關產品文檔
   - 使用AI搜索找到最相關的5篇文檔
   - 收藏重點內容

3. **提案生成階段**
   - 選擇提案模板
   - 使用AI生成個性化提案
   - 檢查生成的提案內容
   - 手動調整部分內容

4. **會議準備階段**
   - 創建會議準備包
   - 選擇相關文檔加入準備包
   - 使用AI分析會議重點

5. **提案發送階段**
   - 導出PDF提案
   - 檢查PDF質量
   - 發送提案 (模擬)

**預期結果**:
- ✅ 整個流程15分鐘內完成
- ✅ 所有功能無縫銜接
- ✅ 無錯誤和中斷
- ✅ 數據一致性完整

**實際結果**: ______________________
**總耗時**: ______ 分鐘
**遇到問題**: ______________________
**狀態**: ⬜ Pass ⬜ Fail

---

## 📊 測試進度追蹤

### 測試執行計劃

| 測試階段 | 測試用例數 | 計劃開始日期 | 計劃完成日期 | 實際完成日期 | 狀態 |
|---------|-----------|------------|------------|------------|------|
| **階段1: 認證系統** | 3 | ________ | ________ | ________ | ⬜ |
| **階段2: 儀表板** | 1 | ________ | ________ | ________ | ⬜ |
| **階段3: 知識庫** | 5 | ________ | ________ | ________ | ⬜ |
| **階段4: 提案系統** | 4 | ________ | ________ | ________ | ⬜ |
| **階段5: 客戶管理** | 2 | ________ | ________ | ________ | ⬜ |
| **階段6: 通知系統** | 2 | ________ | ________ | ________ | ⬜ |
| **階段7: 會議準備** | 2 | ________ | ________ | ________ | ⬜ |
| **階段8: 系統設置** | 2 | ________ | ________ | ________ | ⬜ |
| **階段9: API中間件** | 3 | ________ | ________ | ________ | ⬜ |
| **階段10: 後端服務** | 8 | ________ | ________ | ________ | ⬜ |
| **階段11: 整合測試** | 1 | ________ | ________ | ________ | ⬜ |
| **總計** | **33** | ________ | ________ | ________ | ⬜ |

### 測試統計儀表板

```
總測試用例數: 33
已執行: _____ / 33 (___%)
通過: _____ / _____ (___%)
失敗: _____ / _____ (___%)
阻塞: _____ / _____ (___%)
```

### 缺陷統計

| 缺陷嚴重性 | 數量 | 已修復 | 待修復 |
|-----------|------|--------|--------|
| 🔴 嚴重 (Critical) | ____ | ____ | ____ |
| 🟡 重要 (Major) | ____ | ____ | ____ |
| 🟢 一般 (Minor) | ____ | ____ | ____ |
| 🔵 輕微 (Trivial) | ____ | ____ | ____ |

---

## 📝 測試記錄模板

### 缺陷報告模板

```markdown
## 缺陷ID: BUG-001

**發現日期**: YYYY-MM-DD
**發現人**: ___________
**測試用例**: TC-XXX-XXX
**嚴重性**: 🔴 嚴重 / 🟡 重要 / 🟢 一般 / 🔵 輕微
**優先級**: P1 / P2 / P3 / P4

### 缺陷描述
_詳細描述問題現象_

### 重現步驟
1. 步驟1
2. 步驟2
3. 步驟3

### 預期結果
_應該發生什麼_

### 實際結果
_實際發生了什麼_

### 截圖/日誌
_附加截圖或錯誤日誌_

### 環境信息
- 瀏覽器: _____________
- 操作系統: ___________
- 用戶角色: ___________

### 修復狀態
⬜ 待修復
⬜ 修復中
⬜ 已修復待驗證
⬜ 已關閉
```

---

## ✅ 驗收準則

### 功能性驗收準則

#### 前端功能
- ✅ 所有30個頁面可正常訪問和操作
- ✅ 所有表單驗證正常工作
- ✅ 所有交互反饋清晰 (加載狀態、成功/錯誤提示)
- ✅ 響應式設計在移動端正常顯示
- ✅ 無控制台JavaScript錯誤

#### 後端功能
- ✅ 所有77個API端點返回正確響應
- ✅ 數據驗證和安全檢查全部通過
- ✅ 所有後台任務正常執行
- ✅ 審計日誌完整記錄所有關鍵操作
- ✅ 緩存系統正常工作

#### 整合功能
- ✅ Azure OpenAI整合穩定 (成功率 > 95%)
- ✅ Dynamics 365數據同步正常
- ✅ Microsoft Graph日曆同步正常
- ✅ 郵件通知發送成功

### 性能驗收準則

- ✅ 頁面加載時間 < 2秒
- ✅ API響應時間 < 500ms (99th percentile)
- ✅ 搜索響應時間 < 1秒
- ✅ AI生成提案時間 < 10秒
- ✅ PDF生成時間 < 5秒
- ✅ 支援並發用戶數 > 100

### 安全驗收準則

- ✅ 所有敏感數據已加密存儲
- ✅ JWT認證機制正常工作
- ✅ RBAC權限控制正確
- ✅ CORS策略配置正確
- ✅ 速率限制防止濫用
- ✅ SQL注入防護有效
- ✅ XSS防護有效
- ✅ CSRF防護有效

### 可用性驗收準則

- ✅ 系統可用性 > 99.9%
- ✅ 無關鍵功能故障
- ✅ 錯誤恢復機制正常
- ✅ 數據備份策略已實施
- ✅ 災難恢復計劃已測試

---

## 📌 附錄

### A. 測試環境URL

```
開發環境: http://localhost:3000
Staging環境: https://staging.yourdomain.com
生產環境: https://yourdomain.com

API文檔: http://localhost:3000/api-docs
健康檢查: http://localhost:3000/api/health
```

### B. 測試賬號

```
ADMIN:
  Email: admin@test.com
  Password: [測試密碼]

SALES_MANAGER:
  Email: manager@test.com
  Password: [測試密碼]

SALES_REP:
  Email: rep@test.com
  Password: [測試密碼]
```

### C. 常用測試命令

```bash
# 啟動開發服務器
npm run dev

# 執行單元測試
npm test

# 執行E2E測試
npm run test:e2e

# 檢查TypeScript錯誤
npm run type-check

# 執行ESLint
npm run lint

# 生成測試覆蓋率報告
npm run test:coverage

# 查看數據庫
npm run db:studio

# 健康檢查
curl http://localhost:3000/api/health
```

### D. 測試數據清理

```sql
-- 清理測試數據 (謹慎使用!)
DELETE FROM "AuditLog" WHERE user_email LIKE '%@test.com';
DELETE FROM "Reminder" WHERE created_by IN (SELECT id FROM "User" WHERE email LIKE '%@test.com');
DELETE FROM "Document" WHERE created_by IN (SELECT id FROM "User" WHERE email LIKE '%@test.com');
DELETE FROM "Proposal" WHERE created_by IN (SELECT id FROM "User" WHERE email LIKE '%@test.com');
-- 最後刪除測試用戶
DELETE FROM "User" WHERE email LIKE '%@test.com';
```

---

## 📞 支援與聯繫

**測試負責人**: ___________________
**技術支援**: ___________________
**緊急聯繫**: ___________________

---

**文檔版本**: 1.0
**最後更新**: 2025-10-08
**下次審查日期**: ___________________
